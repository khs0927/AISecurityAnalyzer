<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeartCare 유니버설 링크</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1, h2 { 
            color: #FF6D94; 
        }
        .card {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .url {
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            word-break: break-all;
            margin: 15px 0;
            overflow-x: auto;
        }
        .button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            background-color: #FF6D94;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            text-decoration: none;
            cursor: pointer;
        }
        .button.secondary {
            background-color: #4630EB;
        }
        .button.plain {
            background-color: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
        }
        .note {
            background-color: #fff8e1;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 14px;
        }
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        #log {
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
            max-height: 150px;
            overflow-y: auto;
        }
        .toggle-group {
            display: flex;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            margin: 15px 0;
        }
        .toggle-option {
            flex: 1;
            padding: 10px;
            text-align: center;
            background-color: #f5f5f5;
            cursor: pointer;
        }
        .toggle-option.active {
            background-color: #FF6D94;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>HeartCare 유니버설 링크</h1>
    
    <div class="card">
        <h2>모든 가능한 연결 방법</h2>
        <p>아래 버튼들로 다양한 방식의 Expo 연결을 시도해보세요.</p>
        
        <div class="toggle-group">
            <div class="toggle-option active" onclick="setActiveTab(this, 'ios')">iOS용</div>
            <div class="toggle-option" onclick="setActiveTab(this, 'android')">Android용</div>
        </div>
        
        <div id="ios-content">
            <div class="options">
                <a href="https://expo.dev/@hsml/heart-care-expo" class="button">방법 1: https 링크 (웹 리디렉션)</a>
                <a href="exps://exp.host/@hsml/heart-care-expo?runtime-version=exposdk:50.0.0" class="button secondary">방법 2: exps:// 스킴 (iOS 추천)</a>
                <a href="expo://exp.host/@hsml/heart-care-expo?runtime-version=exposdk:50.0.0" class="button">방법 3: expo:// 스킴 시도</a>
                <button onclick="openUniversalLink()" class="button plain">방법 4: 유니버설 링크 시도</button>
            </div>
            
            <div class="note">
                <p><strong>iOS 연결 팁:</strong></p>
                <ul>
                    <li>Safari 브라우저 사용을 권장합니다</li>
                    <li>'방문 웹사이트에서 앱 열기'를 허용해야 합니다</li>
                    <li>버튼을 길게 눌러 "Safari에서 열기" 옵션을 선택해볼 수 있습니다</li>
                </ul>
            </div>
        </div>
        
        <div id="android-content" style="display: none;">
            <div class="options">
                <a href="https://expo.dev/@hsml/heart-care-expo" class="button">방법 1: https 링크 (웹 리디렉션)</a>
                <a href="exp://exp.host/@hsml/heart-care-expo?runtime-version=exposdk:50.0.0" class="button secondary">방법 2: exp:// 스킴 (Android 추천)</a>
                <a href="expo://exp.host/@hsml/heart-care-expo?runtime-version=exposdk:50.0.0" class="button">방법 3: expo:// 스킴 시도</a>
                <a href="intent://exp.host/@hsml/heart-care-expo?runtime-version=exposdk:50.0.0#Intent;scheme=exp;package=host.exp.exponent;end" class="button plain">방법 4: Android Intent 스킴</a>
            </div>
            
            <div class="note">
                <p><strong>Android 연결 팁:</strong></p>
                <ul>
                    <li>Chrome 브라우저를 권장합니다</li>
                    <li>Expo Go 앱이 설치되어 있어야 합니다</li>
                    <li>Intent 스킴은 일부 Android 기기에서만 작동합니다</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="card">
        <h2>URL 직접 입력</h2>
        <p>Expo Go 앱에서 다음 URL을 직접 입력하세요:</p>
        
        <div class="url" id="directUrl">exp://exp.host/@hsml/heart-care-expo?runtime-version=exposdk:50.0.0</div>
        <button onclick="copyToClipboard()" class="button">URL 복사하기</button>
        
        <div class="note">
            <p><strong>Expo Go 앱에서 URL 입력 방법:</strong></p>
            <ol>
                <li>Expo Go 앱 실행</li>
                <li>오른쪽 하단의 '프로필' 탭 선택</li>
                <li>상단의 'URL 입력' 또는 'Enter URL manually' 선택</li>
                <li>위에서 복사한 URL 붙여넣기</li>
            </ol>
        </div>
    </div>
    
    <div class="card">
        <h2>연결 문제 해결</h2>
        <button onclick="runConnectionTest()" class="button">연결 진단 테스트 실행</button>
        <div id="log"></div>
        
        <div class="options" style="margin-top: 15px;">
            <a href="/expo-final-connect.html" class="button plain">최종 연결 페이지로 이동</a>
            <a href="/mobile-guide.html" class="button plain">상세 가이드 보기</a>
            <a href="/connection-test.html" class="button plain">고급 연결 테스트</a>
        </div>
    </div>

    <script>
        // 탭 전환 기능
        function setActiveTab(element, tabId) {
            // 모든 탭 비활성화
            document.querySelectorAll('.toggle-option').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 클릭한 탭 활성화
            element.classList.add('active');
            
            // 컨텐츠 영역 전환
            document.getElementById('ios-content').style.display = tabId === 'ios' ? 'block' : 'none';
            document.getElementById('android-content').style.display = tabId === 'android' ? 'block' : 'none';
            
            // URL 업데이트 (OS에 따라 다른 URL 표시)
            const urlElement = document.getElementById('directUrl');
            if (tabId === 'ios') {
                urlElement.textContent = 'exps://exp.host/@hsml/heart-care-expo?runtime-version=exposdk:50.0.0';
            } else {
                urlElement.textContent = 'exp://exp.host/@hsml/heart-care-expo?runtime-version=exposdk:50.0.0';
            }
        }
        
        // URL 복사 기능
        function copyToClipboard() {
            const url = document.getElementById('directUrl').textContent;
            
            navigator.clipboard.writeText(url).then(function() {
                alert('URL이 클립보드에 복사되었습니다!');
            }, function(err) {
                alert('클립보드 복사 중 오류가 발생했습니다: ' + err);
            });
        }
        
        // 유니버설 링크 열기
        function openUniversalLink() {
            try {
                // iOS Universal Links 형식
                window.location.href = 'https://exp.host/--/to-exp/exp%3A%2F%2Fexp.host%2F%40hsml%2Fheart-care-expo%3Fruntime-version%3Dexposdk%3A50.0.0';
                logMessage('유니버설 링크 시도 중...');
            } catch (e) {
                logMessage('오류: ' + e.message);
            }
        }
        
        // 연결 진단 테스트
        function runConnectionTest() {
            const logElement = document.getElementById('log');
            logElement.innerHTML = '';
            
            // OS 감지
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isAndroid = /Android/.test(navigator.userAgent);
            
            logMessage('장치 감지 중...');
            logMessage(isIOS ? '→ iOS 장치 감지됨' : isAndroid ? '→ Android 장치 감지됨' : '→ 데스크톱 또는 알 수 없는 장치');
            
            // 브라우저 감지
            const browser = detectBrowser();
            logMessage(`→ ${browser} 브라우저 사용 중`);
            
            // 연결 상태 확인
            logMessage('네트워크 연결 확인 중...');
            logMessage(navigator.onLine ? '→ 온라인 상태' : '→ 오프라인 상태 (연결 필요)');
            
            // 권장사항 표시
            logMessage('권장 연결 방법:');
            if (isIOS) {
                if (browser === 'Safari') {
                    logMessage('→ exps:// 스킴 사용 (iOS Safari 최적화)');
                } else {
                    logMessage('→ Safari 브라우저로 전환하세요');
                }
            } else if (isAndroid) {
                logMessage('→ exp:// 또는 expo:// 스킴 사용');
            } else {
                logMessage('→ 모바일 기기에서 시도하세요');
            }
        }
        
        // 로그 메시지 표시
        function logMessage(message) {
            const logElement = document.getElementById('log');
            const messageElement = document.createElement('div');
            messageElement.textContent = message;
            logElement.appendChild(messageElement);
            
            // 스크롤을 항상 아래로 유지
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // 브라우저 감지
        function detectBrowser() {
            const userAgent = navigator.userAgent;
            
            if (/Safari/.test(userAgent) && !/Chrome/.test(userAgent)) {
                return 'Safari';
            } else if (/Chrome/.test(userAgent)) {
                return 'Chrome';
            } else if (/Firefox/.test(userAgent)) {
                return 'Firefox';
            } else if (/Edge/.test(userAgent)) {
                return 'Edge';
            } else {
                return '알 수 없는 브라우저';
            }
        }
        
        // 페이지 로드 시 자동 설정
        window.onload = function() {
            // 기기 감지 및 적절한 탭 선택
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isAndroid = /Android/.test(navigator.userAgent);
            
            if (isAndroid) {
                document.querySelectorAll('.toggle-option')[1].click();
            }
            
            // URL 파라미터 확인
            const urlParams = new URLSearchParams(window.location.search);
            const autoConnect = urlParams.get('auto');
            
            if (autoConnect === 'true') {
                setTimeout(function() {
                    // 자동 연결 시도
                    if (isIOS) {
                        window.location.href = 'exps://exp.host/@hsml/heart-care-expo?runtime-version=exposdk:50.0.0';
                    } else if (isAndroid) {
                        window.location.href = 'exp://exp.host/@hsml/heart-care-expo?runtime-version=exposdk:50.0.0';
                    }
                }, 1000);
            }
        };
    </script>
</body>
</html>