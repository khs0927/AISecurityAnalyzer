name: ìë™í™” íŒŒì´í”„ë¼ì¸ ì‹œì‘

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'ì„œë²„ ìˆ˜ì • ë¸Œëœì¹˜ ìƒì„±'
        required: true
        default: 'fix/server-typescript'
        type: string
      auto_merge:
        description: 'ìë™ ë¨¸ì§€ í™œì„±í™”'
        required: false
        default: 'true'
        type: boolean

jobs:
  start-pipeline:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Create server fix branch
        run: |
          git checkout -b ${{ github.event.inputs.branch }}
          git push -u origin ${{ github.event.inputs.branch }}
      
      - name: Verify API keys
        run: |
          if [ -f ".env" ]; then
            echo "í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤."
            cp .env.pipeline .env.verified
          else
            echo "í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ì„ ë³µì‚¬í•©ë‹ˆë‹¤."
            cp .env.pipeline .env
          fi
          
          git add .env || echo "ì´ë¯¸ ì¶”ì  ì¤‘ì´ê±°ë‚˜ .gitignoreì— ë“±ë¡ë¨"
          git commit -m "ğŸ”§ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •" || echo "ì»¤ë°‹í•  ë³€ê²½ì‚¬í•­ ì—†ìŒ"
          git push origin ${{ github.event.inputs.branch }}
      
      - name: Trigger server fix pipeline
        uses: peter-evans/repository-dispatch@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          event-type: trigger-pipeline-server-fix
          client-payload: '{"branch": "${{ github.event.inputs.branch }}", "auto_merge": ${{ github.event.inputs.auto_merge }}}'
      
      - name: Start pipeline notification
        run: |
          echo "ğŸš€ íŒŒì´í”„ë¼ì¸ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!"
          echo "ë‹¤ìŒ ë‹¨ê³„ê°€ ìë™ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤:"
          echo "â‘  ì„œë²„ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì˜¤ë¥˜ ìˆ˜ì •"
          echo "â‘¡ í™ˆÂ·ê·¸ë˜í”„ ì‹¤ë™ì‘ êµ¬í˜„"
          echo "â‘¢ WebSocket ìœ„í—˜ë„ íƒ­ êµ¬í˜„"
          echo "â‘£ AI ìœ„í—˜ë„ API êµ¬í˜„"
          echo "â‘¤ ì§€ë„Â·ì•½í•™ API êµ¬í˜„"
          echo "â‘¥ UX í´ë¦¬ì‹± & ìµœì¢… ë°°í¬" 